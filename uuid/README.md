# uuid

分布式ID生成


# Usage

```go
// 初始化传入workerID, etcd地址，和命名空间前缀
uuid.Init(1234, "localhost:2379", "keyspace")

// 返回一个ID，可用于角色、工会ID，使用发号器算法
id := NextID()

// 返回一个UUID，可用于事件行为、日志ID，通常值比较大，使用雪花算法
uuid := NextUUID()

```

### 雪花算法

* 把一个64位的整数分成3个区间，分别用于`时间戳`、`workerID`和`sequenceID`；
* 时间戳代表时间单元的一直递增，不同的时间单元实现有毫秒、秒、厘秒等，这里依赖了时钟不回调；
* `workerID`用来标识分布式环境下的每个app，单独分配给每个机器（或者进程）；
* `sequenceID`在一个时间单元内持续自增，如果时间单元内溢出了，需要sleep等待进入下一个时间单元；

不同的雪花算法实现的差异主要集中在3个区间的分配，和workerID自动还是手动分配上。

### 发号器算法

* 假设算法是一个发号器
* 分布式环境下每个app向发号器申请领取一个号段
* app内部使用这个号段向业务层分配ID
* 号段分配完以后，再向发号器申请下一个号段

发号器依赖存储组件，存储组件内部维持一个counter和step，发号器每次收到申请将此counter自增

本包提供两种存储选择，etcd和redis

* etcd使用单个key的revision来实现自增
* redis使用incr命令